AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Functions for ARM and x86

  '
Resources:
  ARMGoFloat:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: ArmGoFloat
      CodeUri: ARMGoFloat
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - arm64
      Timeout: 120
      Tags:
        Name: ARMGoFloat
      Policies:
      - AWSLambdaExecute
      - DynamoDBWritePolicy:
          TableName:
            Ref: ARMDynamoDBTable
      Environment:
        Variables:
          TABLE_NAME:
            Ref: ARMDynamoDBTable
    Metadata:
      BuildMethod: makefile
      SamResourceId: ARMGoFloat
  ARMGoFloatURL:
    Type: AWS::Lambda::Url
    Properties:
      AuthType: NONE
      TargetFunctionArn:
        Ref: ARMGoFloat
  permissionForURLInvokeArmFloat:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName:
        Ref: ARMGoFloat
      FunctionUrlAuthType: NONE
      Action: lambda:InvokeFunctionUrl
      Principal: '*'
  ARMGoInt:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: ArmGoInt
      CodeUri: ARMGoInt
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - arm64
      Timeout: 120
      Tags:
        Name: ARMGoInt
      Policies:
      - AWSLambdaExecute
      - DynamoDBWritePolicy:
          TableName:
            Ref: ARMDynamoDBTable
      Environment:
        Variables:
          TABLE_NAME:
            Ref: ARMDynamoDBTable
    Metadata:
      BuildMethod: makefile
      SamResourceId: ARMGoInt
  ARMGoIntURL:
    Type: AWS::Lambda::Url
    Properties:
      AuthType: NONE
      TargetFunctionArn:
        Ref: ARMGoInt
  permissionForURLInvokeArmInt:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName:
        Ref: ARMGoInt
      FunctionUrlAuthType: NONE
      Action: lambda:InvokeFunctionUrl
      Principal: '*'
  IntelGoInt:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: IntelGoInt
      CodeUri: IntelGoInt
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Timeout: 120
      Tags:
        Name: IntelGoInt
      Policies:
      - AWSLambdaExecute
      - DynamoDBWritePolicy:
          TableName:
            Ref: ARMDynamoDBTable
      Environment:
        Variables:
          TABLE_NAME:
            Ref: ARMDynamoDBTable
    Metadata:
      BuildMethod: makefile
      SamResourceId: IntelGoInt
  IntelGoIntURL:
    Type: AWS::Lambda::Url
    Properties:
      AuthType: NONE
      TargetFunctionArn:
        Ref: IntelGoInt
  permissionForURLInvokeIntelInt:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName:
        Ref: IntelGoInt
      FunctionUrlAuthType: NONE
      Action: lambda:InvokeFunctionUrl
      Principal: '*'
  IntelGoFloat:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: IntelGoFloat
      CodeUri: IntelGoFloat
      Handler: bootstrap
      Runtime: provided.al2
      Architectures:
      - x86_64
      Timeout: 120
      Tags:
        Name: IntelGoFloat
      Policies:
      - AWSLambdaExecute
      - DynamoDBWritePolicy:
          TableName:
            Ref: ARMDynamoDBTable
      Environment:
        Variables:
          TABLE_NAME:
            Ref: ARMDynamoDBTable
    Metadata:
      BuildMethod: makefile
      SamResourceId: IntelGoFloat
  IntelGoFloatURL:
    Type: AWS::Lambda::Url
    Properties:
      AuthType: NONE
      TargetFunctionArn:
        Ref: IntelGoFloat
  permissionForURLInvokeIntelFloat:
    Type: AWS::Lambda::Permission
    Properties:
      FunctionName:
        Ref: IntelGoFloat
      FunctionUrlAuthType: NONE
      Action: lambda:InvokeFunctionUrl
      Principal: '*'
  ARMDynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: ARMDynamo
      AttributeDefinitions:
      - AttributeName: Email
        AttributeType: S
      - AttributeName: Date
        AttributeType: S
      KeySchema:
      - AttributeName: Email
        KeyType: HASH
      - AttributeName: Date
        KeyType: RANGE
      BillingMode: PAY_PER_REQUEST
      ProvisionedThroughput:
        ReadCapacityUnits: 0
        WriteCapacityUnits: 0
Outputs:
  ARMDynamo:
    Value:
      Ref: ARMDynamoDBTable
    Description: DynamoDb Table to test lambdas
  ARMGoFloatLambdafn:
    Value:
      Ref: ARMGoFloat
    Description: Fn for Go ARM float
  ARMGoFloatLambdaURL:
    Value:
      Fn::GetAtt:
      - ARMGoFloatURL
      - FunctionUrl
  IntelGoFloatLambdafn:
    Value:
      Ref: IntelGoFloatURL
    Description: Fn for Go Intel Float
  IntelGoFloatLambdaURL:
    Value:
      Fn::GetAtt:
      - IntelGoFloatURL
      - FunctionUrl
